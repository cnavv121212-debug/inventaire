<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Inventaire Maintenance</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#667eea;padding:20px}
.container{background:#fff;border-radius:12px;max-width:1400px;margin:auto;padding:20px}
h1{text-align:center}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left}
th{background:#2d3748;color:#fff}
.low{color:red;font-weight:bold}
.good{color:green;font-weight:bold}
input[type=number]{width:60px}
button{padding:6px 10px;border:none;border-radius:5px;cursor:pointer}
.add{background:#48bb78;color:#fff}
.remove{background:#f56565;color:#fff}
</style>
</head>

<body>
<div class="container">
<h1>ðŸ“‹ Inventaire Maintenance</h1>

<table>
<thead>
<tr>
<th>RÃ©f</th>
<th>DÃ©signation</th>
<th>MÃ©tier</th>
<th>Stock</th>
<th>Min</th>
<th>UnitÃ©</th>
<th>Action</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxQNCgeizruXn4XiFx-pgmmVS73s33wRE554s-ka7YATpkRK7ag-Y8_CMJqL8wNkGH2/exec";

let inventory = [];

/* =========================
   CHARGEMENT DES DONNÃ‰ES
========================= */
async function loadData(){
  const res = await fetch(API_URL);
  inventory = await res.json();
  render();
}

/* =========================
   AFFICHAGE
========================= */
function render(){
  const tbody = document.getElementById("table");
  tbody.innerHTML = "";

  inventory.forEach((item,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.ref}</td>
      <td>${item.designation}</td>
      <td>${item.metier}</td>
      <td class="${item.stock < item.stockMin ? 'low':'good'}">${item.stock}</td>
      <td>${item.stockMin}</td>
      <td>${item.unit}</td>
      <td>
        <input type="number" id="q${i}" value="1" min="1">
        <button class="add" onclick="updateStock(${i},1)">+</button>
        <button class="remove" onclick="updateStock(${i},-1)">-</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* =========================
   MISE Ã€ JOUR GOOGLE SHEET
========================= */
async function updateStock(index, sens){
  const qty = parseInt(document.getElementById(`q${index}`).value)||1;
  inventory[index].stock += sens * qty;
  if(inventory[index].stock < 0) inventory[index].stock = 0;

  await fetch(API_URL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      action:"update",
      ref:inventory[index].ref,
      stock:inventory[index].stock
    })
  });

  render();
}

/* =========================
   AUTO REFRESH
========================= */
setInterval(loadData, 10000); // refresh toutes les 10s

loadData();
</script>
</body>
</html>
